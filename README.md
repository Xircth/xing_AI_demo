# âœ¨ å…´ä¹‹åŠ© - æœ¬åœ°å¤§æ¨¡å‹é—®ç­”ç³»ç»Ÿ

[![GitHub Repo stars](https://img.shields.io/github/stars/Xircth/weather_QA_system?style=social)](https://github.com/Xircth/weather_QA_system)

ä¸€ä¸ªåŸºäºè½»é‡çº§å¤§æ¨¡å‹ï¼ˆQwen2.5-0.5B-Instructï¼‰å’Œ RAG (Retrieval-Augmented Generation) æŠ€æœ¯æ„å»ºçš„æœ¬åœ°åŒ–æ™ºèƒ½é—®ç­”ç³»ç»Ÿã€‚æ—¨åœ¨æ¢ç´¢å’Œå®è·µæœ¬åœ°éƒ¨ç½² LLMã€ç»“åˆå¤–éƒ¨çŸ¥è¯†åº“ï¼ˆå¦‚ä¸ªäººç®€å†ï¼‰å’Œå·¥å…·ï¼ˆå¦‚å¤©æ°”æŸ¥è¯¢ï¼‰çš„åº”ç”¨ã€‚

**é¡¹ç›®ä»“åº“åœ°å€:** [https://github.com/Xircth/weather_QA_system.git](https://github.com/Xircth/weather_QA_system.git)

---

## ğŸš€ ä¸»è¦åŠŸèƒ½

*   **ğŸ¤– æœ¬åœ° LLM æ¨ç†**: ä½¿ç”¨è½»é‡çº§ Qwen2.5-0.5B æ¨¡å‹ï¼Œæ”¯æŒæœ¬åœ° CPU/GPU (åŒ…æ‹¬ AMD ROCm) è¿›è¡Œæ¨ç†ã€‚
*   **ğŸ“š ç®€å† RAG é—®ç­”**: æ”¯æŒä¸Šä¼ ä¸ªäººç®€å†ï¼ˆTXT, PDF, DOCX, å›¾ç‰‡ï¼‰ï¼Œæ„å»ºå‘é‡çŸ¥è¯†åº“ï¼Œå¹¶é’ˆå¯¹ç®€å†å†…å®¹è¿›è¡Œæ™ºèƒ½é—®ç­”ã€‚
*   **â˜€ï¸ å¤©æ°”æŸ¥è¯¢å·¥å…·**: é›†æˆå¤©æ°”æŸ¥è¯¢åŠŸèƒ½ï¼Œå¯é€šè¿‡è‡ªç„¶è¯­è¨€æŸ¥è¯¢æŒ‡å®šåŸå¸‚å’Œæ—¥æœŸçš„å¤©æ°”ã€‚
*   **ğŸ’¬ å¤šåŠŸèƒ½å¯¹è¯**: æ”¯æŒé€šç”¨çŸ¥è¯†é—®ç­”ã€**å›ºå®šé—®ç­”**åŒ¹é…ï¼ˆåŸºäº`fixed_qa.json`ï¼‰ä»¥åŠä¸Šè¿° RAG å’Œå·¥å…·è°ƒç”¨ã€‚
*   **ğŸ–¥ï¸ ç°ä»£ Web ç•Œé¢**: ä½¿ç”¨ Streamlit æ„å»ºï¼Œæä¾›ç®€æ´æ˜“ç”¨çš„å¤šé¡µé¢äº¤äº’ç•Œé¢ã€‚
*   **ğŸ“„ æ–‡ä»¶å¤„ç†**: é›†æˆ OCR åŠŸèƒ½ï¼ˆä¾èµ– Tesseractï¼‰ï¼Œå¯å¤„ç† PDF å’Œå›¾ç‰‡æ ¼å¼çš„ç®€å†ã€‚
*   **ğŸ³ Docker æ”¯æŒ**: æä¾› Dockerfileï¼Œæ–¹ä¾¿å¿«é€Ÿéƒ¨ç½²å’Œç¯å¢ƒéš”ç¦»ã€‚

---
## ğŸ› ï¸ æŠ€æœ¯æ ˆ

*   **æ ¸å¿ƒæ¡†æ¶**: Streamlit, Langchain (Core, Community)
*   **LLM ä¸æ¨ç†**: Transformers, Accelerate, PyTorch, PEFT (ç”¨äºå¾®è°ƒè„šæœ¬)
*   **å‘é‡æ•°æ®åº“ä¸æ£€ç´¢**: FAISS (CPU), Langchain HuggingFace Embeddings (BAAI/bge-small-zh-v1.5)
*   **å·¥å…·ä¸æ•°æ®å¤„ç†**: Requests, BeautifulSoup4, Pillow, python-docx, docx2txt, pdfplumber, pytesseract, pdf2image
*   **éƒ¨ç½²**: Docker

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸»è¦ç»„ä»¶ååŒå·¥ä½œï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  Streamlit UI   â”‚â”€â”€â”€â–¶â”‚   QA System     â”‚â”€â”€â”€â–¶â”‚ Middleware      â”‚
â”‚ (app.py, pages/)â”‚    â”‚ (qa_system.py)  â”‚    â”‚ (middleware.py) â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚         \      /
                             â”‚          `----Â´
                             â”‚            â”‚
                             â–¼            â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ LLM Service â”‚â”‚ RAG Module  â”‚â”‚     Tools       â”‚
                     â”‚(llm_service)â”‚â”‚(resume_rag) â”‚â”‚   (tools.py)    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

*   **Streamlit UI (`app.py`, `pages/`)**: ç”¨æˆ·äº¤äº’ç•Œé¢ï¼Œè´Ÿè´£å±•ç¤ºå¯¹è¯ã€æ¥æ”¶è¾“å…¥ã€æ–‡ä»¶ä¸Šä¼ ç­‰ã€‚é€šè¿‡ `session_state` ç®¡ç†ä¼šè¯ã€‚
*   **QA System (`qa_system.py`)**: **æ ¸å¿ƒæ§åˆ¶å™¨** (å•ä¾‹)ã€‚æ¥æ”¶å‰ç«¯è¯·æ±‚ï¼Œåˆå§‹åŒ–å¹¶ç®¡ç†å…¶ä»–åç«¯æ¨¡å—ã€‚å®ƒè´Ÿè´£å¤„ç†æŸ¥è¯¢çš„ä¸»æµç¨‹ï¼šä¼˜å…ˆè¿›è¡Œ RAG æ£€ç´¢ï¼ˆå¦‚æœå¼€å¯ï¼‰ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦åŒ¹é…**å›ºå®šé—®ç­”** (`fixed_qa.json`)ï¼Œæœ€åè°ƒç”¨ **Middleware** è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚åŒæ—¶ç®¡ç†ç®€å†ä¸Šä¼ å’ŒçŸ¥è¯†åº“æ„å»ºæµç¨‹ã€‚
*   **Middleware (`middleware.py`)**: **ä¸šåŠ¡é€»è¾‘å¤„ç†å±‚**ã€‚æ¥æ”¶æ¥è‡ª QA System çš„æŸ¥è¯¢ï¼ˆå¯èƒ½åŒ…å« RAG ä¸Šä¸‹æ–‡æˆ–æ— ä¸Šä¸‹æ–‡ï¼‰ã€‚å¦‚æœå¸¦æœ‰ RAG ä¸Šä¸‹æ–‡ï¼Œç›´æ¥è°ƒç”¨ **LLM Service** ç”ŸæˆåŸºäºä¸Šä¸‹æ–‡çš„å›å¤ã€‚å¦åˆ™ï¼Œè°ƒç”¨ **LLM Service** åˆ¤æ–­æŸ¥è¯¢æ„å›¾ï¼ˆé€šç”¨ã€å¤©æ°”ã€éœ€ RAGï¼‰ï¼Œå¹¶åè°ƒè°ƒç”¨ **Tools** (å¤©æ°”æŸ¥è¯¢) æˆ–å°†ç»“æœ/çŠ¶æ€è¿”å›ç»™ QA Systemã€‚
*   **LLM Service (`llm_service.py`)**: å°è£…**å¤§æ¨¡å‹**çš„åŠ è½½ï¼ˆä½¿ç”¨ `device_map='auto'`ï¼‰å’Œæ¨ç†ã€‚æä¾› `generate_response` æ¥å£ï¼Œèƒ½æ ¹æ®ä¸åŒ `prompt_type` (é€šç”¨ã€RAGã€å¤©æ°”æç¤º) æ ¼å¼åŒ– Prompt å¹¶è·å–æ¨¡å‹è¾“å‡ºã€‚
*   **RAG Module (`resume_rag.py`)**: è´Ÿè´£**ç®€å†çŸ¥è¯†åº“**çš„æ„å»ºã€åŠ è½½ (FAISS) å’Œæ£€ç´¢ã€‚åŒ…å«æ–‡æœ¬å’Œå›¾ç‰‡ (OCR) çš„å¤„ç†é€»è¾‘ï¼Œä»¥åŠæ–‡æœ¬åˆ†å‰²å’Œå‘é‡åŒ–ã€‚
*   **Tools (`tools.py`)**: å®ç°å…·ä½“çš„**å¤–éƒ¨åŠŸèƒ½**ï¼Œç›®å‰ä¸»è¦æ˜¯ `get_weather` å·¥å…·ï¼Œæ”¯æŒå¤šç§å¤©æ°” APIã€‚
*   **Utils (`utils.py`, `config.json`)**: æä¾›**é…ç½®ç®¡ç†** (`Config` ç±») å’Œ **æ—¥å¿—è®¾ç½®** (`setup_logger`) ç­‰å…¬å…±æœåŠ¡ã€‚
*   **Models (`models.py`)**: åŒ…å«**æ¨¡å‹å¾®è°ƒ**ç›¸å…³çš„ç±» (`ModelFineTuner`)ï¼Œä¸»è¦ç”± `scripts/finetune.py` ä½¿ç”¨ã€‚

---
##é¡µé¢å›¾ä¾‹ï¼š

![image](https://github.com/user-attachments/assets/f98dba0f-6b84-4940-b4b9-6eda278a8d52)
![image](https://github.com/user-attachments/assets/4416dde7-3a14-491b-b2c4-364bde0818fa)
![image](https://github.com/user-attachments/assets/ed20229b-c3ec-4036-ac71-42f9252da5aa)
ä»¥ä¸Šå›¾ä¾‹ä»…ä¾›å‚è€ƒ

## ğŸš€ éƒ¨ç½²ä¸è¿è¡Œ

### æ–¹å¼ä¸€ï¼šæœ¬åœ°è¿è¡Œ

**1. ç¯å¢ƒè¦æ±‚:**
   - Python 3.8+
   - Git
   - (å¯é€‰) æ”¯æŒ ROCm çš„ AMD GPU æˆ– æ”¯æŒ CUDA çš„ Nvidia GPU
   - (å¯é€‰, è‹¥éœ€å¤„ç†PDF/å›¾ç‰‡ç®€å†) Tesseract OCR å’Œ Poppler

**2. å®‰è£…æ­¥éª¤:**
   ```bash
   # å…‹éš†ä»“åº“
   git clone https://github.com/Xircth/weather_QA_system.git
   cd weather_QA_system

   # (æ¨è) åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
   # python -m venv .venv
   # source .venv/bin/activate  # Linux/macOS
   # .\.venv\Scripts\activate  # Windows

   # å®‰è£…ä¾èµ–
   pip install -r requirements.txt
   ```

**3. (å¯é€‰) å®‰è£… OCR ä¾èµ–:**
   - **Windows**: 
     - å®‰è£… Tesseract: [UB-Mannheim/tesseract/wiki](https://github.com/UB-Mannheim/tesseract/wiki)
     - å®‰è£… Poppler: [oschwartz10612/poppler-windows/releases](https://github.com/oschwartz10612/poppler-windows/releases)
     - å°† Tesseract å’Œ Poppler çš„ `bin` ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ `PATH`ã€‚
   - **Linux (Debian/Ubuntu)**:
     ```bash
     sudo apt-get update && sudo apt-get install -y tesseract-ocr tesseract-ocr-chi-sim poppler-utils libtesseract-dev
     ```

**4. è¿è¡Œåº”ç”¨:**
   ```bash
   streamlit run app.py
   ```
   ç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:8501`ã€‚

### æ–¹å¼äºŒï¼šDocker éƒ¨ç½²

**1. ç¯å¢ƒè¦æ±‚:**
   - Docker Desktop æˆ– Docker Engine å·²å®‰è£…å¹¶è¿è¡Œã€‚

**2. æ„å»ºé•œåƒ:**
   ```bash
   # åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ
   docker build -t xing_langchain_chat .
   ```
   *   **æ³¨æ„**: å¦‚æœéœ€è¦åœ¨å®¹å™¨å†…ä½¿ç”¨ï¼Œè¯·ç¡®ä¿ `Dockerfile` ä¸­å®‰è£… Tesseract å’Œ Poppler çš„å‘½ä»¤æœ‰æ•ˆã€‚

**3. è¿è¡Œå®¹å™¨:**
   ```bash
   docker run -p 8501:8501 xing_langchain_chat
   ```
   è®¿é—® `http://localhost:8501`ã€‚

**4. (å¯é€‰) æ•°æ®æŒä¹…åŒ–ä¸é…ç½®æŒ‚è½½:**
   ```bash
   # æŒä¹…åŒ–æ—¥å¿—å’Œå‘é‡æ•°æ®åº“
   docker volume create weather_qa_logs
   docker volume create weather_qa_vector_store
   docker run -p 8501:8501 \
     -v weather_qa_logs:/app/logs \
     -v weather_qa_vector_store:/app/data/vector_store \
     xing_langchain_chat

   # æŒ‚è½½æœ¬åœ°é…ç½®æ–‡ä»¶ (æ–¹ä¾¿ä¿®æ”¹)
   # ç¡®ä¿æœ¬åœ°å­˜åœ¨ config.json
   docker run -p 8501:8501 -v ./config.json:/app/config.json xing_langchain_chat
   ```

---

## ğŸ“– ä½¿ç”¨è¯´æ˜

1.  **é€‰æ‹©æ¨¡å¼**: åœ¨ä¾§è¾¹æ é€‰æ‹© **æ™®é€šé—®ç­”** æˆ– **ç®€å†é—®ç­”** æ¨¡å¼ã€‚
2.  **ç®€å†é—®ç­”**: 
    *   åœ¨ **ç®€å†é—®ç­”** é¡µé¢ä¸Šä¼ ç®€å†æ–‡ä»¶ï¼ˆTXT, PDF, DOCXï¼‰æˆ–å›¾ç‰‡ã€‚
    *   ç‚¹å‡»"å¤„ç†ç®€å†"æŒ‰é’®ï¼Œç­‰å¾…çŸ¥è¯†åº“æ„å»ºå®Œæˆã€‚
    *   åœ¨ä¸‹æ–¹çš„èŠå¤©æ¡†ä¸­é’ˆå¯¹ç®€å†å†…å®¹æé—®ã€‚
3.  **æ™®é€šé—®ç­”**: 
    *   ç›´æ¥åœ¨èŠå¤©æ¡†ä¸­è¾“å…¥æ‚¨çš„é—®é¢˜ã€‚
    *   æ”¯æŒé€šç”¨çŸ¥è¯†é—®ç­”å’Œå¤©æ°”æŸ¥è¯¢ï¼ˆä¾‹å¦‚ï¼š"æˆéƒ½æ˜å¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"ï¼‰ã€‚

---

## âš™ï¸ é…ç½®è¯´æ˜

ä¸»è¦é…ç½®æ–‡ä»¶ä¸º `config.json`ï¼Œå¯è°ƒæ•´ä»¥ä¸‹å†…å®¹ï¼š

*   `model`: å¤§æ¨¡å‹è·¯å¾„ã€æ¨ç†è®¾å¤‡åå¥½ã€ç”Ÿæˆå‚æ•°ç­‰ã€‚
*   `embedding`: åµŒå…¥æ¨¡å‹åç§°ã€è®¾å¤‡ã€åˆ†å—è®¾ç½®ç­‰ã€‚
*   `vector_db`: å‘é‡æ•°æ®åº“å­˜å‚¨è·¯å¾„ã€‚
*   `weather_api`: å¤©æ°”æŸ¥è¯¢ API é…ç½®ï¼ˆæ”¯æŒå¿ƒçŸ¥å¤©æ°”ã€å’Œé£å¤©æ°”ã€WeatherAPI.comï¼Œé»˜è®¤ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰ã€‚è¯·å‚è€ƒæ³¨é‡Šæˆ– `tools.py` é…ç½®çœŸå®çš„ API Key ä»¥è·å–å®æ—¶å¤©æ°”ã€‚
*   `app`: åº”ç”¨ç•Œé¢ç›¸å…³é…ç½®ï¼ˆå¦‚æ ‡é¢˜ï¼‰ã€‚
*   `logging`: æ—¥å¿—çº§åˆ«å’Œæ–‡ä»¶è·¯å¾„ã€‚

---

## ğŸ§° è¾…åŠ©è„šæœ¬

`scripts/` ç›®å½•ä¸‹åŒ…å«ç”¨äºæ¨¡å‹å¾®è°ƒå’ŒçŸ¥è¯†åº“æ„å»ºçš„è¾…åŠ©è„šæœ¬ï¼š

*   **`build_resume_kb.py`**: æ‰‹åŠ¨æ„å»ºç®€å†çŸ¥è¯†åº“ï¼ˆåŸºäº `data/æ–‡æœ¬ç®€å†/RAG.md`ï¼‰ã€‚
*   **`finetune.py`**: ä½¿ç”¨ LoRA å¯¹åŸºç¡€æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼ˆéœ€è¦å‡†å¤‡è®­ç»ƒæ•°æ®ï¼‰ã€‚

```bash
# æ‰‹åŠ¨æ„å»ºçŸ¥è¯†åº“
python scripts/build_resume_kb.py

# è¿è¡Œå¾®è°ƒ (ç¤ºä¾‹)
python scripts/finetune.py --data your_dataset.json --output models/my_finetuned_model --tag my_tag
```

---

## ğŸ¤” å¸¸è§é—®é¢˜

1.  **PDF/DOCX/å›¾ç‰‡å¤„ç†å¤±è´¥**: ç¡®ä¿ OCR ä¾èµ–å·²æ­£ç¡®å®‰è£…å¹¶é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå‚è€ƒæœ¬åœ°éƒ¨ç½²æ­¥éª¤ï¼‰ã€‚
2.  **æ¨¡å—å¯¼å…¥é”™è¯¯**: å°è¯•ä½¿ç”¨ `streamlit run app.py` å¯åŠ¨ï¼Œæˆ–ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ä¸”ä¾èµ–å®‰è£…æ­£ç¡®ã€‚
3.  **CUDA/ROCm é”™è¯¯**: æ£€æŸ¥é©±åŠ¨æ˜¯å¦æ­£ç¡®å®‰è£…ï¼Œæˆ–åœ¨ `config.json` ä¸­å°† `model.device` è®¾ç½®ä¸º `"cpu"`ã€‚
4.  **å›ºå®šé—®ç­”ä¸ç”Ÿæ•ˆ**: æ£€æŸ¥ `src/fixed_qa.json` æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®ã€‚

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT](LICENSE) è®¸å¯è¯ã€‚ 
